(()=>{var Q=Object.create;var w=Object.defineProperty;var X=Object.getOwnPropertyDescriptor;var Z=Object.getOwnPropertyNames;var tt=Object.getPrototypeOf,et=Object.prototype.hasOwnProperty;var rt=(t,e)=>()=>(t&&(e=t(t=0)),e);var A=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var nt=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Z(e))!et.call(t,o)&&o!==n&&w(t,o,{get:()=>e[o],enumerable:!(r=X(e,o))||r.enumerable});return t};var g=(t,e,n)=>(n=t!=null?Q(tt(t)):{},nt(e||!t||!t.__esModule?w(n,"default",{value:t,enumerable:!0}):n,t));function c(t){return(...e)=>{if(window["@Neos:HostPluginAPI"]&&window["@Neos:HostPluginAPI"][`@${t}`])return window["@Neos:HostPluginAPI"][`@${t}`](...e);throw new Error("You are trying to read from a consumer api that hasn't been initialized yet!")}}var b=rt(()=>{});var y=A((_t,v)=>{b();v.exports=c("vendor")().React});var C=A((Ft,_)=>{b();_.exports=c("NeosProjectPackages")().ReactUiComponents});var T=A((Bt,F)=>{b();F.exports=c("NeosProjectPackages")().NeosUiDecorators});var B=A((te,H)=>{b();H.exports=c("NeosProjectPackages")().NeosUiEditors});b();var R=c("manifest");var u=g(y());var N=t=>{let e={};return!t||typeof t!="object"||Array.isArray(t)||Object.entries(t).forEach(([n,r])=>{if(!r||typeof r!="object"||Array.isArray(r)||!("label"in r)||typeof r.label!="string")return;let o="collapsed"in r&&r.collapsed===!0;e[n]={key:n,label:r.label,collapsed:o}}),e},S="default",I=t=>{if(!("linkAttributes"in t)||!t.linkAttributes||typeof t.linkAttributes!="object"||Array.isArray(t.linkAttributes))return[];let e=[];return Object.keys(t.linkAttributes).forEach(n=>{let r=t.linkAttributes[n];if(!r)return;if(typeof r=="string")return e.push({attribute:n,label:r,group:S});if(typeof r!="object"||Array.isArray(r)||!("label"in r&&typeof r.label=="string"))return;let o="help"in r&&typeof r.help=="string"?r.help:void 0,l="placeholder"in r&&typeof r.placeholder=="string"?r.placeholder:void 0,i="group"in r&&typeof r.group=="string"?r.group:S;return e.push({attribute:n,label:r.label,help:o,placeholder:l,group:i})}),e},j=t=>{let e=t.reduce((n,r)=>({...n,[r.group]:[...n[r.group]??[],r]}),{});return Object.entries(e)};var k=t=>t.reduce((e,[n,r])=>(e[n]=r,e),{});var a=g(y());var d=g(y()),h=g(C()),G=({inputId:t,option:e,i18nRegistry:n})=>{let[r,o]=(0,d.useState)(!1),l=()=>o(i=>!i);return d.default.createElement("div",null,d.default.createElement("div",{style:{display:"flex",justifyContent:"space-between"}},d.default.createElement(h.Label,{htmlFor:t},n.translate(e.label)),e.help&&d.default.createElement("span",{role:"button",onClick:l},d.default.createElement(h.Icon,{icon:"question-circle"}))),e.help&&r&&d.default.createElement(h.Tooltip,{renderInline:!0},n.translate(e.help)))};var O=g(C());var it=0,E=()=>`prgfx-le-id${++it}`;var st={padding:8,border:0,margin:0,position:"relative",width:"100%"},at={display:"block",top:8,marginBottom:8,position:"relative"},lt={position:"absolute",top:"-3ch",right:0},ut=t=>({display:t?"none":"flex",flexWrap:"wrap",gap:8}),V=t=>t.collapsed===!0&&t.options.every(({attribute:e})=>!(e in t.values)||t.values[e]===""),W=t=>{let[e,n]=(0,a.useState)(V(t)),r=(0,a.useRef)(!1),o=E(),l=E();return(0,a.useEffect)(()=>{r.current||Object.keys(t.values).length>0&&(n(V(t)),r.current=!0)},[t.values]),a.default.createElement("fieldset",{style:st},a.default.createElement("legend",{style:at,id:o},t.i18nRegistry.translate(t.label)),a.default.createElement("div",{style:lt},a.default.createElement(O.IconButton,{icon:e?"chevron-circle-down":"chevron-circle-up",onClick:()=>n(i=>!i),style:"transparent",size:"small","aria-expanded":!e,"aria-controls":l,"aria-labelledby":o})),a.default.createElement("div",{style:ut(e),id:l},t.options.map((i,m)=>{let f=`link-attribute-input-${m}`;return a.default.createElement("div",{key:i.attribute},a.default.createElement(G,{option:i,inputId:f,i18nRegistry:t.i18nRegistry}),a.default.createElement(O.TextInput,{id:f,value:t.values[i.attribute],onChange:t.onChange(i.attribute),placeholder:t.i18nRegistry.translate(i.placeholder)}))})))};var K=g(y()),U=g(T()),D=()=>(0,K.useContext)(U.NeosContext);var M=t=>{let{onLinkChange:e}=t,{globalRegistry:n}=D(),r=(0,u.useMemo)(()=>{let s=n.get("frontendConfiguration").get("Prgfx.Neos.LinkEditor");return N(s.groups)},[n]),[o,l]=(0,u.useState)({}),i=(0,u.useMemo)(()=>I(t.linkingOptions),[t.linkingOptions]),m=(0,u.useMemo)(()=>j(i).filter(([s])=>s in r),[i,r]);(0,u.useEffect)(()=>{try{let s=new URL(t.linkValue);s.search&&(s.searchParams,l(k(i.map(p=>[p.attribute,s.searchParams.get(p.attribute)??""]))))}catch{l(k(i.map(p=>[p.attribute,""])))}},[t.linkValue,i]);let f=(0,u.useCallback)(s=>p=>{l(q=>{let J={...q,[s]:p};try{let x=new URL(t.linkValue),L=x.searchParams;p.length===0&&L.has(s)?L.delete(s):L.set(s,p),e(x.toString())}catch{}return J})},[t.linkValue,e]);return u.default.createElement(u.default.Fragment,null,m.map(([s,p])=>u.default.createElement(W,{key:s,label:r[s].label,i18nRegistry:t.i18nRegistry,options:p,onChange:f,values:o,collapsed:r[s].collapsed})))};var $=g(y());var z=g(B()),Y=t=>{let{linking:e,...n}=t.options,o=t.neos.globalRegistry.get("frontendConfiguration").get("Prgfx.Neos.LinkEditor").linkEditor?.ignoredOptions??[],l={...e,...k(o.map(i=>[i,!1]))};return $.default.createElement(z.LinkInput,{linkValue:t.value,onLinkChange:t.commit,options:n,linkingOptions:l})};R("Prgfx.Neos.LinkEditor:LinkEditor",{},(t,{frontendConfiguration:e})=>{t.get("containers").set("LinkInput/OptionsPanel/LinkAttributeEditor",M,"end"),e["Prgfx.Neos.LinkEditor"].linkEditor.replace&&t.get("inspector").get("editors").set("Neos.Neos/Inspector/Editors/LinkEditor",{component:Y});let o=t.get("dataLoaders").get("LinkLookup"),l=o.resolveValue,i=(m,f)=>{let s=typeof f=="string"&&/^node:\/\//.test(f)?f.split("?")[0]:f;return l.call(o,m,s)};o.resolveValue=i.bind(o)});})();
