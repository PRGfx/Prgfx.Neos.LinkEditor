(()=>{var X=Object.create;var E=Object.defineProperty;var Z=Object.getOwnPropertyDescriptor;var tt=Object.getOwnPropertyNames;var et=Object.getPrototypeOf,rt=Object.prototype.hasOwnProperty;var ot=(t,e)=>()=>(t&&(e=t(t=0)),e);var A=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var nt=(t,e,o,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of tt(e))!rt.call(t,n)&&n!==o&&E(t,n,{get:()=>e[n],enumerable:!(r=Z(e,n))||r.enumerable});return t};var d=(t,e,o)=>(o=t!=null?X(et(t)):{},nt(e||!t||!t.__esModule?E(o,"default",{value:t,enumerable:!0}):o,t));function c(t){return(...e)=>{if(window["@Neos:HostPluginAPI"]&&window["@Neos:HostPluginAPI"][`@${t}`])return window["@Neos:HostPluginAPI"][`@${t}`](...e);throw new Error("You are trying to read from a consumer api that hasn't been initialized yet!")}}var b=ot(()=>{});var y=A((Wt,S)=>{b();S.exports=c("vendor")().React});var C=A((Kt,G)=>{b();G.exports=c("NeosProjectPackages")().ReactUiComponents});var K=A(($t,T)=>{b();T.exports=c("NeosProjectPackages")().NeosUiDecorators});var z=A((re,H)=>{b();H.exports=c("NeosProjectPackages")().NeosUiEditors});b();var R=c("manifest");var u=d(y());var I=t=>{let e={};return!t||typeof t!="object"||Array.isArray(t)||Object.entries(t).forEach(([o,r])=>{if(!r||typeof r!="object"||Array.isArray(r)||!("label"in r)||typeof r.label!="string")return;let n="collapsed"in r&&r.collapsed===!0;e[o]={key:o,label:r.label,collapsed:n}}),e},N="default",j=t=>{if(!("linkAttributes"in t)||!t.linkAttributes||typeof t.linkAttributes!="object"||Array.isArray(t.linkAttributes))return[];let e=[];return Object.keys(t.linkAttributes).forEach(o=>{let r=t.linkAttributes[o];if(!r)return;if(typeof r=="string")return e.push({attribute:o,label:r,group:N});if(typeof r!="object"||Array.isArray(r)||!("label"in r&&typeof r.label=="string"))return;let n="help"in r&&typeof r.help=="string"?r.help:void 0,l="placeholder"in r&&typeof r.placeholder=="string"?r.placeholder:void 0,i="group"in r&&typeof r.group=="string"?r.group:N;return e.push({attribute:o,label:r.label,help:n,placeholder:l,group:i})}),e},_=t=>{let e=t.reduce((o,r)=>({...o,[r.group]:[...o[r.group]??[],r]}),{});return Object.entries(e)};var k=t=>t.reduce((e,[o,r])=>(e[o]=r,e),{});var a=d(y());var f=d(y()),h=d(C()),O={wrapper:{position:"relative"},container:{display:"flex",justifyContent:"space-between"},tooltipWrapper:{position:"relative",zIndex:10},infoButton:{cursor:"pointer"}},W=({inputId:t,option:e,i18nRegistry:o})=>{let[r,n]=(0,f.useState)(!1),l=()=>n(i=>!i);return f.default.createElement("div",{style:O.wrapper},f.default.createElement("div",{style:O.container},f.default.createElement(h.Label,{htmlFor:t},o.translate(e.label)),e.help&&f.default.createElement("span",{role:"button",onClick:l,style:O.infoButton},f.default.createElement(h.Icon,{icon:"question-circle"}))),e.help&&r&&f.default.createElement("div",{style:O.tooltipWrapper},f.default.createElement(h.Tooltip,null,o.translate(e.help))))};var x=d(C());var st=0,P=()=>`prgfx-le-id${++st}`;var at={padding:8,border:0,margin:0,position:"relative",width:"100%"},lt={display:"block",top:8,marginBottom:8,position:"relative"},ut={position:"absolute",top:"-3ch",right:0},ct=t=>({display:t?"none":"flex",flexWrap:"wrap",gap:8}),pt={flexGrow:1},V=t=>t.collapsed===!0&&t.options.every(({attribute:e})=>!(e in t.values)||t.values[e]===""),F=t=>{let[e,o]=(0,a.useState)(V(t)),r=(0,a.useRef)(!1),n=P(),l=P();return(0,a.useEffect)(()=>{r.current||Object.keys(t.values).length>0&&(o(V(t)),r.current=!0)},[t.values]),a.default.createElement("fieldset",{style:at},a.default.createElement("legend",{style:lt,id:n},t.i18nRegistry.translate(t.label)),a.default.createElement("div",{style:ut},a.default.createElement(x.IconButton,{icon:e?"chevron-circle-down":"chevron-circle-up",onClick:()=>o(i=>!i),style:"transparent",size:"small","aria-expanded":!e,"aria-controls":l,"aria-labelledby":n})),a.default.createElement("div",{style:ct(e),id:l},t.options.map((i,m)=>{let g=`link-attribute-input-${m}`;return a.default.createElement("div",{key:i.attribute,style:pt},a.default.createElement(W,{option:i,inputId:g,i18nRegistry:t.i18nRegistry}),a.default.createElement(x.TextInput,{id:g,value:t.values[i.attribute],onChange:t.onChange(i.attribute),placeholder:t.i18nRegistry.translate(i.placeholder)}))})))};var U=d(y()),D=d(K()),M=()=>(0,U.useContext)(D.NeosContext);var B=t=>{let{onLinkChange:e}=t,{globalRegistry:o}=M(),r=(0,u.useMemo)(()=>{let s=o.get("frontendConfiguration").get("Prgfx.Neos.LinkEditor");return I(s.groups)},[o]),[n,l]=(0,u.useState)({}),i=(0,u.useMemo)(()=>j(t.linkingOptions),[t.linkingOptions]),m=(0,u.useMemo)(()=>_(i).filter(([s])=>s in r),[i,r]);(0,u.useEffect)(()=>{try{let s=new URL(t.linkValue);s.search&&(s.searchParams,l(k(i.map(p=>[p.attribute,s.searchParams.get(p.attribute)??""]))))}catch{l(k(i.map(p=>[p.attribute,""])))}},[t.linkValue,i]);let g=(0,u.useCallback)(s=>p=>{l(J=>{let Q={...J,[s]:p};try{let L=new URL(t.linkValue),w=L.searchParams;p.length===0&&w.has(s)?w.delete(s):w.set(s,p),e(L.toString())}catch{}return Q})},[t.linkValue,e]);return u.default.createElement(u.default.Fragment,null,m.map(([s,p])=>u.default.createElement(F,{key:s,label:r[s].label,i18nRegistry:t.i18nRegistry,options:p,onChange:g,values:n,collapsed:r[s].collapsed})))};var $=d(y());var Y=d(z()),q=t=>{let{linking:e,...o}=t.options,n=t.neos.globalRegistry.get("frontendConfiguration").get("Prgfx.Neos.LinkEditor").linkEditor?.ignoredOptions??[],l={...e,...k(n.map(i=>[i,!1]))};return $.default.createElement(Y.LinkInput,{linkValue:t.value,onLinkChange:t.commit,options:o,linkingOptions:l})};R("Prgfx.Neos.LinkEditor:LinkEditor",{},(t,{frontendConfiguration:e})=>{t.get("containers").set("LinkInput/OptionsPanel/LinkAttributeEditor",B,"end"),e["Prgfx.Neos.LinkEditor"].linkEditor.replace&&t.get("inspector").get("editors").set("Neos.Neos/Inspector/Editors/LinkEditor",{component:q});let n=t.get("dataLoaders").get("LinkLookup"),l=n.resolveValue,i=(m,g)=>{let s=typeof g=="string"&&/^node:\/\//.test(g)?g.split("?")[0]:g;return l.call(n,m,s)};n.resolveValue=i.bind(n)});})();
